apiVersion: v1
kind: ConfigMap
metadata:
  name: grafana-dashboard-grafana
  namespace: grafana
  labels:
    grafana_dashboard: "1"
data:
  grafana.json: |
    {
      "title": "Grafana (self)",
      "refresh": "10s",
      "schemaVersion": 38,
      "panels": [
        { "type":"stat", "title":"Grafana Up",
          "gridPos":{"x":0,"y":0,"w":6,"h":4},
          "targets":[{ "expr":"max(up{job=~\".*grafana.*\"})" }]
        },
        { "type":"timeseries", "title":"HTTP req/s",
          "gridPos":{"x":0,"y":4,"w":12,"h":8},
          "targets":[{ "expr":"sum(rate(grafana_http_request_total[5m])) by (handler, status_code)" }]
        },
        { "type":"timeseries", "title":"HTTP p95 latency (s)",
          "gridPos":{"x":0,"y":12,"w":12,"h":8},
          "targets":[{ "expr":"histogram_quantile(0.95, sum by (le) (rate(grafana_http_request_duration_seconds_bucket[5m])))" }]
        },
        { "type":"timeseries", "title":"Active Alerts",
          "gridPos":{"x":0,"y":20,"w":12,"h":8},
          "targets":[{ "expr":"sum(grafana_alerting_active_alerts)" }]
        },
        { "type":"timeseries", "title":"CPU / Memory",
          "gridPos":{"x":0,"y":28,"w":12,"h":8},
          "targets":[
            { "expr":"rate(process_cpu_seconds_total{job=~\".*grafana.*\"}[5m])" },
            { "expr":"process_resident_memory_bytes{job=~\".*grafana.*\"}" }
          ]
        }
      ]
    }
